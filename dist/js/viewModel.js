function Location(e,t){var i=this;i.name=e,i.address=t,i.marker=null,i.thirdPartyPhotos=null,i.thirdPartyData=null}function ListItem(e,t){this.item=e,this.visible=ko.observable(t)}function LocationViewModel(){var e=this,t=null;e.listItems=ko.observableArray([new ListItem(new Location("Google","1600 Amphitheatre Pkwy, Mountain View, CA 94043"),(!0)),new ListItem(new Location("Shoreline Amphitheatre","1 Amphitheatre Pkwy, Mountain View, CA 94043"),(!0)),new ListItem(new Location("Mozart Foundation Automobile Museum","1325 Pear Ave, Mountain View, CA 94043"),(!0)),new ListItem(new Location("Computer History Museum","1401 N Shoreline Blvd, Mountain View, CA 94043"),(!0)),new ListItem(new Location("Century Cinema 16","1500 N Shoreline Blvd, Mountain View, CA 94043"),(!0))]),e.filter=function(){for(var t=filterInputElement.val(),i=0;i<e.listItems().length;i++)e.listItems()[i].item.name.substring(0,t.length).toLowerCase()===t.toLowerCase()?(e.listItems()[i].visible(!0),e.listItems()[i].item.marker.setMap(map)):(e.listItems()[i].visible(!1),e.listItems()[i].item.marker.setMap(null));return 0===t.length&&e.removeFilter(),!0},e.removeFilter=function(){for(var t=0;t<e.listItems().length;t++)e.listItems()[t].visible(!0),e.listItems()[t].item.marker.setMap(map);filterInputElement.val(""),infoWindow.close()},e.getMarker=function(t,a,r){$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+a.replace(/ /g,"+")+MAP_KEY,function(a){var n=findItemInArray(e.listItems,t);if(e.listItems()[n].item.marker=new google.maps.Marker({position:{lat:a.results[0].geometry.location.lat,lng:a.results[0].geometry.location.lng},map:map,title:t}),e.attachInfoWindow(e.listItems()[n].item.marker),e.listItems()[n].item.thirdPartyPhotos=imageHTML.replace("%%data","https://maps.googleapis.com/maps/api/streetview?size=300x150&location="+a.results[0].geometry.location.lat+","+a.results[0].geometry.location.lng+"&heading=200&pitch=-0.76&key="+MAP_KEY),i++,i===r){for(var o=new Array(5),s=0;s<e.listItems().length;s++)o[s]=e.listItems()[s].item.marker;resizeMap(o)}}).fail(function(t,i,a){e.errorPrompt("Failed to load data from Google please refresh")})},e.getThirdPartyData=function(t,i){$.ajax({method:"GET",url:"https://api.foursquare.com/v2/venues/search?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRECT+"&v=20130815 &near=Mountain+View&query="+t.replace(/ /g,"+")+"&address"+i.replace(/ /g,"+")}).done(function(i){var a=findItemInArray(e.listItems,t),r=headerHTML.replace("%%data",i.response.venues[0].name);r+=infoHTML.replace("%%data","People here now").replace("%%data",i.response.venues[0].hereNow.count),r+=infoHTML.replace("%%data","Check in count").replace("%%data",i.response.venues[0].stats.checkinsCount),r+=hyperLinkHTML.replace("%%data","https://foursquare.com/").replace("%%data","Provided by Foursquare"),e.listItems()[a].item.thirdPartyData=r}).fail(function(t,i,a){e.errorPrompt("Failed to load data from FourSquare please refresh")})},e.attachInfoWindow=function(t){t.addListener("click",function(){for(var i=0;i<e.listItems().length;i++)if(t===e.listItems()[i].item.marker){e.displayInfoWindow(e.listItems()[i].item);break}})},e.selectMarker=function(t){e.displayInfoWindow(t.item)},e.displayInfoWindow=function(i){t===i.marker?e.resetMarkers():(t=i.marker,e.resetOtherMarkers(),infoWindow.setContent(i.thirdPartyPhotos+i.thirdPartyData),infoWindow.open(map,i.marker),i.marker.setAnimation(google.maps.Animation.BOUNCE))},e.resetMarkers=function(){for(var i=0;i<e.listItems().length;i++)e.listItems()[i].item.marker.setAnimation(null);infoWindow.close(),t=null},e.resetOtherMarkers=function(){for(var t=0;t<e.listItems().length;t++)e.listItems()[t].item.marker.setAnimation(null)};for(var i=0,a=e.listItems().length,r=0;r<e.listItems().length;r++)e.getMarker(e.listItems()[r].item.name,e.listItems()[r].item.address,a),e.getThirdPartyData(e.listItems()[r].item.name,e.listItems()[r].item.address);e.errorPrompt=function(e){}}function findItemInArray(e,t){for(var i=0;i<e().length;i++)if(e()[i].item.name===t)return i;return-1}var MAP_KEY="AIzaSyCkW6FCwPhwzhiHG48DbjzCFP_1lGXLQWA",CLIENT_ID="ZWI00VLLOOCDO3KNPL1URSOBTSK3BNUVJYTI3PDMDQES4E2S",CLIENT_SECRECT="QLCIS5IGUN1QWOW5GLCKBTAKIISEFE3QHTS011R1C0DLI1DP",infoWindow=new google.maps.InfoWindow,headerHTML='<h1 class="info-header">%%data</h1>',infoHTML='<p class="info-p">%%data %%data</p>',hyperLinkHTML='<a href="%%data" class="info-hyperlink">%%data</a>',imageHTML='<img src="%%data">',filterInputElement=$("#filter-input");ko.applyBindings(new LocationViewModel);